mutate(WeeklyRank = rank(-points, ties.method = "average")) %>%
left_join(Lookups, by = c("WeeklyRank" = "Rank")) %>%
rename("Franchise" = "Franchise/Week") %>%
filter(!(points == 0)) %>%
filter(!(week == "PF")) %>%
left_join(Teams, by = "Franchise") %>%
mutate(
Change = ifelse(week == max(as.numeric(week), na.rm = TRUE), F1Pts, 0),
Wins = if_else(WeeklyRank == 1, 1, 0),
Podiums = if_else(WeeklyRank < 4, 1, 0),
PtFin = if_else(WeeklyRank < 7, 1, 0)
)
# Current week calculation
current_week <- max(as.numeric(Setup$week), na.rm = TRUE)
weeks_remaining <- 18 - current_week
# Standings calculation
Standings <- Setup %>%
group_by(Name) %>%
summarise(
WeeklyF1Pts = sum(F1Pts),
Wins = sum(Wins),
Podiums = sum(Podiums),
PtFin = sum(PtFin),
WeeklyEarnings = sum(Earnings),
ThisWeek = sum(Change),
AvgWeeklyRank = round(mean(WeeklyRank), 1),
.groups = 'drop'
) %>%
arrange(-WeeklyF1Pts, AvgWeeklyRank) %>%
mutate(Rank = row_number())
# Weekly development data
WeeklyChange <- Setup %>%
group_by(Name) %>%
arrange(as.numeric(week)) %>%
mutate(scoring = cumsum(F1Pts)) %>%
select(Name, week, scoring) %>%
mutate(week = as.numeric(week)) %>%
arrange(-scoring)
# Get this week's top 6 finishers
weekly_top6 <- Setup %>%
ungroup() %>%
filter(as.numeric(week) == current_week) %>%
arrange(WeeklyRank) %>%
slice(1:6) %>%
select(Franchise, Name, points, F1Pts, Earnings) %>%
mutate(
points = round(points, 1),
F1Pts = round(F1Pts, 1),
Earnings = round(Earnings, 2)
)
# Simple kable with podium styling
weekly_table <- kable(weekly_top6,
col.names = c("Team", "Owner", "Fantasy Points", "F1 Points", "Earnings ($)"),
format = "html") %>%
kable_styling(
bootstrap_options = c("striped", "hover", "responsive"),
full_width = TRUE,
position = "center"
)
# Add podium highlighting
if(nrow(weekly_top6) >= 3) {
weekly_table <- weekly_table %>%
row_spec(1, background = "#FFD700", color = "#000000", bold = TRUE) %>%
row_spec(2, background = "#C0C0C0", color = "#000000", bold = TRUE) %>%
row_spec(3, background = "#CD7F32", color = "#000000", bold = TRUE)
}
weekly_table
# Create enhanced standings table
standings_display <- Standings %>%
select(Name, WeeklyF1Pts, Wins, Podiums, PtFin, AvgWeeklyRank, WeeklyEarnings) %>%
mutate(
WeeklyF1Pts = round(WeeklyF1Pts, 1),
WeeklyEarnings = round(WeeklyEarnings, 2)
)
kable(standings_display,
col.names = c("Team", "Total F1 Pts", "Wins", "Podiums", "Point Finishes", "Avg Finish", "YTD Earnings"),
digits = 1,
format.args = list(big.mark = ",")) %>%
kable_styling(
bootstrap_options = c("striped", "hover", "condensed", "responsive"),
full_width = TRUE,
font_size = 14,
position = "center"
) %>%
row_spec(1, background = "#FFD700", color = "#000000", bold = TRUE) %>%
row_spec(2:3, background = "#2d2d2d", color = "#FFD700") %>%
add_header_above(c(" " = 1, "Season Stats" = 5, " " = 1),
background = "#FFD700", color = "#000000")
# Create the main race chart with black and yellow theme
race_plot <- ggplot(WeeklyChange, aes(x = week, y = scoring, color = Name)) +
geom_line(linewidth = 2.5, alpha = 0.9) +
geom_point(size = 3, alpha = 0.9) +
scale_color_manual(values = color_palette) +
scale_x_continuous(
breaks = seq(1, 18, by = 2),
limits = c(1, 18)
) +
scale_y_continuous(breaks = pretty_breaks(n = 8)) +
# Add current week vertical line
geom_vline(xintercept = current_week, linetype = "dashed", color = "#FFD700", alpha = 0.8, size = 1) +
labs(
title = "Fantasy1 Championship Race - Cumulative F1 Points",
subtitle = paste0("Through Week ", current_week, " • ", weeks_remaining, " weeks remaining"),
x = "Week",
y = "Cumulative F1 Points",
caption = "Yellow dashed line shows current week"
) +
theme_fantasy() +
guides(color = guide_legend(nrow = 2, override.aes = list(size = 4)))
# Make it interactive and responsive
ggplotly(race_plot, tooltip = c("x", "y", "colour")) %>%
config(displayModeBar = FALSE, responsive = TRUE) %>%
layout(
paper_bgcolor = "#000000",
plot_bgcolor = "#1a1a1a",
font = list(color = "#FFD700"),
legend = list(
orientation = "h",
x = 0.5,
xanchor = 'center',
y = -0.15,
bgcolor = "#1a1a1a",
bordercolor = "#FFD700",
font = list(color = "#FFD700")
),
margin = list(b = 100)
)
# Create finish consistency chart (REVERSED ORDER - best to worst)
p1 <- ggplot(Setup, aes(x = reorder(Name, WeeklyRank, FUN = median), y = WeeklyRank)) +
geom_boxplot(aes(fill = Name), alpha = 0.8, show.legend = FALSE, color = "#FFD700") +
scale_fill_manual(values = color_palette) +
scale_y_reverse(breaks = 1:12) +
labs(
title = "Weekly Finish Consistency",
x = "Team",
y = "Weekly Rank"
) +
theme_fantasy() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1, size = 11)
)
# Make interactive and full width
ggplotly(p1, tooltip = c("x", "y")) %>%
config(displayModeBar = FALSE, responsive = TRUE) %>%
layout(
paper_bgcolor = "#000000",
plot_bgcolor = "#1a1a1a",
font = list(color = "#FFD700"),
title = list(
text = "<b>Weekly Finish Consistency</b>",
x = 0.5,
font = list(color = "#FFD700")
)
)
# Create points consistency chart (REVERSED ORDER - best to worst)
p2 <- ggplot(Setup, aes(x = reorder(Name, -points, FUN = median), y = points)) +
geom_boxplot(aes(fill = Name), alpha = 0.8, show.legend = FALSE, color = "#FFD700") +
scale_fill_manual(values = color_palette) +
scale_y_continuous(labels = comma_format()) +
labs(
title = "Weekly Points Consistency",
x = "Team",
y = "Fantasy Points"
) +
theme_fantasy() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1, size = 11)
)
# Make interactive and full width
ggplotly(p2, tooltip = c("x", "y")) %>%
config(displayModeBar = FALSE, responsive = TRUE) %>%
layout(
paper_bgcolor = "#000000",
plot_bgcolor = "#1a1a1a",
font = list(color = "#FFD700"),
title = list(
text = "<b>Weekly Points Consistency</b>",
x = 0.5,
font = list(color = "#FFD700")
)
)
# Cap projection calculations
CapProjection <- Standings %>%
left_join(Lookups2, by = "Rank") %>%
mutate(
TotalEarnings = Earnings + WeeklyEarnings,
TotalF1Pts = WeeklyF1Pts + SeasonalF1Pts,
Excess = if_else(TotalF1Pts > 100, TotalF1Pts - 100, 0)
) %>%
mutate(LeagueExcess = sum(Excess)) %>%
mutate(LeagueExcessCount = sum(Excess < 1)) %>%
mutate(SocialSecurity = if_else(Excess > 0, -Excess, LeagueExcess / LeagueExcessCount)) %>%
mutate(Revenue = TotalF1Pts + SocialSecurity) %>%
mutate(Excess2 = if_else(Revenue > 100, Revenue - 100, 0)) %>%
mutate(LeagueExcess2 = sum(Excess2)) %>%
mutate(LeagueExcessCount2 = sum(Revenue < 100)) %>%
mutate(SocialSecurity2 = if_else(Excess2 > 0, -Excess2,
if_else(Revenue < 100, LeagueExcess2 / LeagueExcessCount2, 0))) %>%
mutate(
Socialism = SocialSecurity + SocialSecurity2,
EarnedRevenue = Revenue + Socialism,
Socialism = round(Socialism, digits = 1)
) %>%
left_join(DraftPickRevenue, by = "Name") %>%
left_join(TradedRevenue, by = "Name") %>%
select(Name, WeeklyF1Pts, SeasonalF1Pts, TotalF1Pts, Socialism, Traded26, DPR26) %>%
mutate(TotalCap = TotalF1Pts + Socialism + Traded26 + DPR26 + 230) %>%
left_join(rosters, by = "Name") %>%
left_join(CapHitsCalc, by = "Name") %>%
mutate(
CapHit = replace_na(CapHit, 0),
CapSpace = TotalCap - Salary - CapHit
) %>%
arrange(-CapSpace)
# Clean up the display - separate weekly and seasonal F1 points
cap_display <- CapProjection %>%
mutate(
across(where(is.numeric), ~ round(.x, 1)),
CapSpace = round(CapSpace, 0)
) %>%
select(Name, WeeklyF1Pts, SeasonalF1Pts, TotalF1Pts, Socialism, Traded26, DPR26, TotalCap, Salary, CapHit, CapSpace)
kable(cap_display,
col.names = c("Team", "Weekly F1", "Seasonal F1", "Total F1", "Socialism", "Traded", "DPR", "Total Cap", "Salary", "Cap Hit", "Cap Space"),
format.args = list(big.mark = ",")) %>%
kable_styling(
bootstrap_options = c("striped", "hover", "condensed", "responsive"),
full_width = TRUE,
font_size = 12,
position = "center"
) %>%
add_header_above(c(" " = 1, "F1 Points Breakdown" = 3, "Revenue Sources" = 3, "Cap Situation" = 4),
background = "#FFD700", color = "#000000")
# Rest of Season Simulation with Early Season Uncertainty
set.seed(42)
# Load 2023 historical data
Historical2023 <- read_sheet('1-hbPnZU2dLalXbCRjsDe79vX1eJr6gzon4qnrWYuLro', sheet = "2023Standings")
# Process 2023 data for variance patterns
historical_scores <- Historical2023 %>%
filter(!(`Franchise/Week` %in% c("Average"))) %>%
pivot_longer(cols = !`Franchise/Week`, names_to = "week", values_to = "points") %>%
filter(!(points == 0), !(week == "PF"), !is.na(points)) %>%
mutate(week = as.numeric(week)) %>%
filter(week <= 18)
# Get historical variance metrics
historical_sd <- historical_scores %>%
group_by(`Franchise/Week`) %>%
summarise(team_sd = sd(points, na.rm = TRUE), .groups = 'drop') %>%
filter(!is.na(team_sd)) %>%
summarise(median_sd = median(team_sd)) %>%
pull(median_sd)
# Current season stats with early season adjustments
current_stats <- Setup %>%
group_by(Name) %>%
summarise(
avg_points = mean(points, na.rm = TRUE),
weeks_played = n(),
current_f1_total = sum(F1Pts),
.groups = 'drop'
)
# Calculate league average for regression
league_avg <- mean(current_stats$avg_points)
# Apply early season uncertainty
team_projections <- current_stats %>%
mutate(
# Regression to mean - stronger early in season
confidence_weight = pmin(weeks_played / 6, 1), # Build confidence over 6 weeks
regressed_avg = (avg_points * confidence_weight) + (league_avg * (1 - confidence_weight)),
# Enhanced variance for early season
base_variance = historical_sd,
uncertainty_factor = case_when(
weeks_played == 1 ~ 2.5,  # Very high uncertainty
weeks_played == 2 ~ 2.0,
weeks_played == 3 ~ 1.6,
weeks_played == 4 ~ 1.3,
TRUE ~ 1.0
),
simulation_sd = base_variance * uncertainty_factor
)
# Run simulation
n_sims <- 10000
team_names <- team_projections$Name
n_teams <- length(team_names)
# Storage for results
final_f1_totals <- matrix(0, nrow = n_sims, ncol = n_teams)
# Monte Carlo simulation
for(sim in 1:n_sims) {
running_f1 <- team_projections$current_f1_total
# Simulate remaining weeks
for(week in 1:weeks_remaining) {
# Generate weekly scores with uncertainty
week_scores <- rnorm(n_teams,
mean = team_projections$regressed_avg,
sd = team_projections$simulation_sd)
week_scores <- pmax(week_scores, 0) # No negative scores
# Convert to weekly ranks and F1 points
week_ranks <- rank(-week_scores, ties.method = "random")
week_f1 <- sapply(week_ranks, function(r) {
f1_pts <- Lookups$F1Pts[Lookups$Rank == r]
if(length(f1_pts) > 0) f1_pts[1] else 0
})
running_f1 <- running_f1 + week_f1
}
final_f1_totals[sim, ] <- running_f1
}
# Calculate final standings probabilities
final_ranks <- t(apply(final_f1_totals, 1, function(x) rank(-x, ties.method = "random")))
# Summary statistics
championship_prob <- apply(final_ranks, 2, function(x) mean(x == 1)) * 100
top3_prob <- apply(final_ranks, 2, function(x) mean(x <= 3)) * 100
top5_prob <- apply(final_ranks, 2, function(x) mean(x <= 5)) * 100
projected_final <- apply(final_f1_totals, 2, mean)
projection_sd <- apply(final_f1_totals, 2, sd)
# Create results table
results_table <- data.frame(
Team = team_names,
Current_F1 = team_projections$current_f1_total,
Projected_Final = round(projected_final, 1),
Plus_Minus = paste0("±", round(projection_sd, 1)),
Championship_Prob = paste0(round(championship_prob, 1), "%"),
Top3_Prob = paste0(round(top3_prob, 1), "%"),
Top5_Prob = paste0(round(top5_prob, 1), "%")
) %>%
arrange(-projected_final)
# Display table without highlighting
kable(results_table,
col.names = c("Team", "Current F1", "Projected Final", "±", "Championship %", "Top 3 %", "Top 5 %"),
align = c("l", "c", "c", "c", "c", "c", "c")) %>%
kable_styling(
bootstrap_options = c("striped", "hover", "condensed", "responsive"),
full_width = TRUE,
font_size = 12,
position = "center"
) %>%
add_header_above(c(" " = 1, "F1 Points" = 3, "Probabilities" = 3),
background = "#FFD700", color = "#000000")
View(weekly_top6)
shiny::runApp('GitHub/NicheSportSimsPublic/NascarReview')
runApp('GitHub/NicheSportSimsPublic/NascarReview')
runApp('GitHub/NicheSportSimsPublic/NascarReview')
source("~/.active-rstudio-document", echo = TRUE)
source("~/.active-rstudio-document", echo = TRUE)
source("~/.active-rstudio-document", echo = TRUE)
source("~/.active-rstudio-document", echo = TRUE)
source("~/.active-rstudio-document", echo = TRUE)
source("~/.active-rstudio-document", echo = TRUE)
data <- read.xlsx("Book1.xlsx")
View(data)
data <- read.xlsx("Book1.xlsx") %>%
mutate(GeoMeanStart = round(GeometricMeanStarting,0),
GeoMeanOwn = round(GeomeanOwn,0))
# Create the ggplot
p <- ggplot(data, aes(x = as.factor(GeoMeanOwn), y = Score)) +
geom_boxplot(fill = "gold",
color = "black",
alpha = 0.8,
outlier.color = "black",
outlier.size = 2) +
coord_flip() +
labs(x = "Score",
y = "GeoMean Ownership",
title = "Boxplot of Score by Geomean Ownership") +
theme_minimal() +
theme(
plot.background = element_rect(fill = "white", color = NA),
panel.background = element_rect(fill = "gray95", color = NA),
panel.grid.major = element_line(color = "white", size = 0.5),
panel.grid.minor = element_line(color = "white", size = 0.3),
plot.title = element_text(color = "black", size = 16, face = "bold"),
axis.title = element_text(color = "black", size = 12, face = "bold"),
axis.text = element_text(color = "black", size = 10),
axis.line = element_line(color = "black", size = 0.5)
)
# Convert to interactive plotly
interactive_plot <- ggplotly(p, tooltip = c("x", "y", "middle", "lower", "upper")) %>%
layout(
title = list(text = "Boxplot of Score by Geomean Ownership",
font = list(size = 16, color = "black")),
xaxis = list(title = list(text = "Score",
font = list(color = "black", size = 12))),
yaxis = list(title = list(text = "Geomean Ownership",
font = list(color = "black", size = 12))),
plot_bgcolor = "rgba(245,245,245,1)",
paper_bgcolor = "white"
)
# Display the interactive plot
interactive_plot
# Create the ggplot
p1 <- ggplot(data, aes(x = as.factor(GeoMeanStart), y = Score)) +
geom_boxplot(fill = "gold",
color = "black",
alpha = 0.8,
outlier.color = "black",
outlier.size = 2) +
coord_flip() +
labs(x = "Score",
y = "GeoMean Starting Spot",
title = "Boxplot of Score by Geomean Starting Spot") +
theme_minimal() +
theme(
plot.background = element_rect(fill = "white", color = NA),
panel.background = element_rect(fill = "gray95", color = NA),
panel.grid.major = element_line(color = "white", size = 0.5),
panel.grid.minor = element_line(color = "white", size = 0.3),
plot.title = element_text(color = "black", size = 16, face = "bold"),
axis.title = element_text(color = "black", size = 12, face = "bold"),
axis.text = element_text(color = "black", size = 10),
axis.line = element_line(color = "black", size = 0.5)
)
# Convert to interactive plotly
interactive_plot1 <- ggplotly(p1, tooltip = c("x", "y", "middle", "lower", "upper")) %>%
layout(
title = list(text = "Boxplot of Score by Geomean Starting Spot",
font = list(size = 16, color = "black")),
xaxis = list(title = list(text = "Score",
font = list(color = "black", size = 12))),
yaxis = list(title = list(text = "Geomean Starting Spot",
font = list(color = "black", size = 12))),
plot_bgcolor = "rgba(245,245,245,1)",
paper_bgcolor = "white"
)
# Display the interactive plot
interactive_plot1
source("~/.active-rstudio-document", echo = TRUE)
shiny::runApp('GitHub/NicheSportSimsPublic/Tennis')
runApp('GitHub/NicheSportSimsPublic/TennisReview')
shiny::runApp('GitHub/NicheSportSimsPublic/Database')
shiny::runApp('GitHub/NicheSportSimsPublic/TennisReview')
shiny::runApp('GitHub/NicheSportSimsPublic/TennisReview')
shiny::runApp('GitHub/NicheSportSimsPublic/Tennis')
shiny::runApp('GitHub/NicheSportSimsPublic/Database')
runApp()
shiny::runApp('GitHub/NicheSportSimsPublic/TennisReview')
shiny::runApp('GitHub/NicheSportSimsPublic/Nascar')
shiny::runApp('GitHub/NicheSportSimsPublic/Database')
shiny::runApp('GitHub/NicheSportSimsPublic/MMA')
runApp('GitHub/NicheSportSimsPublic/Nascar')
runApp('GitHub/NicheSportSimsPublic/Nascar')
runApp('GitHub/NicheSportSimsPublic/Nascar')
runApp('GitHub/NicheSportSimsPublic/Nascar')
shiny::runApp('GitHub/NicheSportSimsPublic/MMAReview')
shiny::runApp('nascaR/Nascar/CruzApp')
runApp('GitHub/NicheSportSimsPublic/NascarReview')
runApp('GitHub/NicheSportSimsPublic/NascarReview')
runApp('GitHub/NicheSportSimsPublic/Formula1')
shiny::runApp('GitHub/NicheSportSimsPublic/Formula1')
runApp('GitHub/NicheSportSimsPublic/Formula1')
runApp('GitHub/NicheSportSimsPublic/Formula1')
runApp('GitHub/NicheSportSimsPublic/Formula1')
runApp('GitHub/NicheSportSimsPublic/Formula1')
runApp('GitHub/NicheSportSimsPublic/Formula1')
runApp('GitHub/NicheSportSimsPublic/Formula1')
runApp('GitHub/NicheSportSimsPublic/Formula1')
runApp('GitHub/NicheSportSimsPublic/Formula1Review')
runApp('GitHub/NicheSportSimsPublic/Formula1Review')
runApp('GitHub/NicheSportSimsPublic/Review')
runApp('GitHub/NicheSportSimsPublic/Formula1Review')
shiny::runApp('GitHub/NicheSportSimsPublic/MMA')
shiny::runApp('GitHub/NicheSportSimsPublic/MMADatabase')
source("~/nascaR/CFB/SD Leverage FLEX.R", echo = TRUE)
shiny::runApp('GitHub/NicheSportSimsPublic/Formula1')
runApp('GitHub/NicheSportSimsPublic/Formula1')
source('/home/claude/f1_epa_calculator.R')
source("~/.active-rstudio-document", echo = TRUE)
View(actual_f1_points)
View(actual_team_scores)
View(bench_alternatives)
View(epa_avg_season)
View(epa_bench_season)
View(hypothetical_f1)
View(hypothetical_scores)
View(player_scores_with_teams)
View(player_scores)
View(top_epa_avg)
View(top_win_shares)
View(win_shares_season)
View(epa_vs_avg)
View(epa_avg_season)
shiny::runApp('GitHub/NicheSportSimsPublic/MMADatabase')
runApp('GitHub/NicheSportSimsPublic/MMADatabase')
runApp('GitHub/NicheSportSimsPublic/MMADatabase')
runApp('GitHub/NicheSportSimsPublic/MMADatabase')
runApp('GitHub/NicheSportSimsPublic/MMADatabase')
runApp('GitHub/NicheSportSimsPublic/MMADatabase')
runApp('GitHub/NicheSportSimsPublic/MMADatabase')
runApp('GitHub/NicheSportSimsPublic/MMADatabase')
runApp('GitHub/NicheSportSimsPublic/MMADatabase')
runApp('GitHub/NicheSportSimsPublic/MMADatabase')
shiny::runApp('GitHub/NicheSportSimsPublic/CFBReview')
runApp('~/nascaR/NFL')
runApp('nascaR/NFL')
shiny::runApp('GitHub/NicheSportSimsPublic/Sweat')
runApp('GitHub/NicheSportSimsPublic/Sweat')
source("~/nascaR/Nascar/Grid.R", echo = TRUE)
runApp('~/GitHub/NicheSportSimsPublic/Database')
source("~/nascaR/Nascar/Grid.R", echo = TRUE)
source("~/nascaR/Nascar/Grid.R", echo = TRUE)
View(StartingGrid)
runApp('~/GitHub/GTS/SimApp')
runApp('~/GitHub/GTS/SimApp')
runApp('~/GitHub/GTS/SimApp')
runApp('~/GitHub/GTS/SimApp')
runApp('~/GitHub/GTS/SimApp')
runApp('~/GitHub/GTS/SimApp')
runApp('~/GitHub/GTS/SimApp')
runApp('~/GitHub/GTS/SimApp')
runApp('~/GitHub/GTS/SimApp')
runApp('~/GitHub/GTS/SimApp')
runApp('~/GitHub/GTS/SimApp')
runApp('~/GitHub/GTS/SimApp')
runApp('~/GitHub/NicheSportSimsPublic/Sweat')
shiny::runApp('~/GitHub/GTS/SimApp')
runApp()
